<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Processing scRNAseq Data | ANALYSIS OF SINGLE CELL RNA-SEQ DATA</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Processing scRNAseq Data | ANALYSIS OF SINGLE CELL RNA-SEQ DATA" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://broadinstitute.github.io/2020_scWorkshop/" />
  <meta property="og:image" content="https://broadinstitute.github.io/2020_scWorkshop/images/cover.png" />
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="broadinstitute/2019_scWorkship" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Processing scRNAseq Data | ANALYSIS OF SINGLE CELL RNA-SEQ DATA" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="twitter:image" content="https://broadinstitute.github.io/2020_scWorkshop/images/cover.png" />

<meta name="author" content="Orr Ashenberg" />
<meta name="author" content="Dana Silverbush" />
<meta name="author" content="Kirk Gosik" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lecture-template.html"/>
<link rel="next" href="understanding-sequencing-raw-data.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ANALYSIS OF SINGLE CELL RNA-SEQ DATA</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-overview"><i class="fa fa-check"></i><b>1.1</b> COURSE OVERVIEW</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#targeted-audience-assumed-background"><i class="fa fa-check"></i><b>1.2</b> TARGETED AUDIENCE &amp; ASSUMED BACKGROUND</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#course-format"><i class="fa fa-check"></i><b>1.3</b> COURSE FORMAT</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#getting-started"><i class="fa fa-check"></i><b>1.4</b> Getting Started</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#session-content"><i class="fa fa-check"></i><b>1.5</b> SESSION CONTENT</a><ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#monday"><i class="fa fa-check"></i><b>1.5.1</b> Monday</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#tuesday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.2</b> Tuesday – Classes from 08:00 to 16:00</a></li>
<li class="chapter" data-level="1.5.3" data-path="index.html"><a href="index.html#wednesday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.3</b> Wednesday – Classes from 08:00 to 16:00</a></li>
<li class="chapter" data-level="1.5.4" data-path="index.html"><a href="index.html#thursday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.4</b> Thursday – Classes from 08:00 to 16:00</a></li>
<li class="chapter" data-level="1.5.5" data-path="index.html"><a href="index.html#friday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.5</b> Friday – Classes from 08:00 to 16:00</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lab-template.html"><a href="lab-template.html"><i class="fa fa-check"></i><b>2</b> Lab Template</a><ul>
<li class="chapter" data-level="2.1" data-path="lab-template.html"><a href="lab-template.html#template-example"><i class="fa fa-check"></i><b>2.1</b> Template Example</a></li>
<li class="chapter" data-level="2.2" data-path="lab-template.html"><a href="lab-template.html#make-object"><i class="fa fa-check"></i><b>2.2</b> Make Object</a></li>
<li class="chapter" data-level="2.3" data-path="lab-template.html"><a href="lab-template.html#process-object"><i class="fa fa-check"></i><b>2.3</b> Process Object</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lecture-template.html"><a href="lecture-template.html"><i class="fa fa-check"></i><b>3</b> Lecture Template</a></li>
<li class="chapter" data-level="4" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html"><i class="fa fa-check"></i><b>4</b> Processing scRNAseq Data</a><ul>
<li class="chapter" data-level="4.1" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#goal"><i class="fa fa-check"></i><b>4.1</b> Goal</a></li>
<li class="chapter" data-level="4.2" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#further-reading"><i class="fa fa-check"></i><b>4.2</b> Further reading</a></li>
<li class="chapter" data-level="4.3" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#download-data"><i class="fa fa-check"></i><b>4.3</b> Download data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#fastq-file-format"><i class="fa fa-check"></i><b>4.3.1</b> Fastq file format</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#align-the-reads"><i class="fa fa-check"></i><b>4.4</b> Align the reads</a><ul>
<li class="chapter" data-level="4.4.1" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#star-align"><i class="fa fa-check"></i><b>4.4.1</b> STAR align</a></li>
<li class="chapter" data-level="4.4.2" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#bam-file-format"><i class="fa fa-check"></i><b>4.4.2</b> Bam file format</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#visualization"><i class="fa fa-check"></i><b>4.5</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html"><i class="fa fa-check"></i><b>5</b> Understanding Sequencing Raw Data</a><ul>
<li class="chapter" data-level="5.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#class-environment"><i class="fa fa-check"></i><b>5.1</b> Class Environment</a><ul>
<li class="chapter" data-level="5.1.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#getting-into-aws-instance"><i class="fa fa-check"></i><b>5.1.1</b> Getting into AWS Instance</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#shell-and-unix-commands"><i class="fa fa-check"></i><b>5.2</b> Shell and Unix commands</a><ul>
<li class="chapter" data-level="5.2.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#common-linux-commands"><i class="fa fa-check"></i><b>5.2.1</b> Common Linux Commands</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#file-formats"><i class="fa fa-check"></i><b>5.3</b> File formats</a><ul>
<li class="chapter" data-level="5.3.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#view-fastq-files"><i class="fa fa-check"></i><b>5.3.1</b> View FASTQ Files</a></li>
<li class="chapter" data-level="5.3.2" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#view-bam-files"><i class="fa fa-check"></i><b>5.3.2</b> View BAM Files</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#public-data-repositories"><i class="fa fa-check"></i><b>5.4</b> Public data repositories</a><ul>
<li class="chapter" data-level="5.4.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#cellranger10x"><i class="fa fa-check"></i><b>5.4.1</b> Cellranger/10x</a></li>
<li class="chapter" data-level="5.4.2" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#geo"><i class="fa fa-check"></i><b>5.4.2</b> GEO</a></li>
<li class="chapter" data-level="5.4.3" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#single-cell-portal"><i class="fa fa-check"></i><b>5.4.3</b> Single Cell Portal</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#docker-commands"><i class="fa fa-check"></i><b>5.5</b> Docker Commands</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html"><i class="fa fa-check"></i><b>6</b> Introduction R/Bioconductor</a><ul>
<li class="chapter" data-level="6.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#start-environment"><i class="fa fa-check"></i><b>6.1</b> Start Environment</a><ul>
<li class="chapter" data-level="6.1.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#local-command"><i class="fa fa-check"></i><b>6.1.1</b> Local Command</a></li>
<li class="chapter" data-level="6.1.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#aws-command"><i class="fa fa-check"></i><b>6.1.2</b> AWS Command</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#installing-packages"><i class="fa fa-check"></i><b>6.2</b> Installing packages</a><ul>
<li class="chapter" data-level="6.2.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#cran"><i class="fa fa-check"></i><b>6.2.1</b> CRAN</a></li>
<li class="chapter" data-level="6.2.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#github"><i class="fa fa-check"></i><b>6.2.2</b> Github</a></li>
<li class="chapter" data-level="6.2.3" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#bioconductor"><i class="fa fa-check"></i><b>6.2.3</b> Bioconductor</a></li>
<li class="chapter" data-level="6.2.4" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#source"><i class="fa fa-check"></i><b>6.2.4</b> Source</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#installation-instructions"><i class="fa fa-check"></i><b>6.3</b> Installation instructions:</a><ul>
<li class="chapter" data-level="6.3.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#classestypes"><i class="fa fa-check"></i><b>6.3.1</b> Classes/Types</a></li>
<li class="chapter" data-level="6.3.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#data-structures"><i class="fa fa-check"></i><b>6.3.2</b> Data structures</a></li>
<li class="chapter" data-level="6.3.3" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#detour-to-s3s4"><i class="fa fa-check"></i><b>6.3.3</b> Detour to S3/S4</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#more-information"><i class="fa fa-check"></i><b>6.4</b> More information</a><ul>
<li class="chapter" data-level="6.4.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#checking-for-help-for-any-function"><i class="fa fa-check"></i><b>6.4.1</b> Checking for help for any function!</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#grammer-of-graphics-ggplot2"><i class="fa fa-check"></i><b>6.5</b> Grammer of Graphics (ggplot2)</a><ul>
<li class="chapter" data-level="6.5.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#what-is-ggplot2"><i class="fa fa-check"></i><b>6.5.1</b> What is ggplot2?</a></li>
<li class="chapter" data-level="6.5.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#principles-of-ggplot2"><i class="fa fa-check"></i><b>6.5.2</b> Principles of ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#reference"><i class="fa fa-check"></i><b>6.6</b> Reference</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="identifying-cell-populations.html"><a href="identifying-cell-populations.html"><i class="fa fa-check"></i><b>7</b> Identifying Cell Populations</a><ul>
<li class="chapter" data-level="7.1" data-path="identifying-cell-populations.html"><a href="identifying-cell-populations.html#google-slides"><i class="fa fa-check"></i><b>7.1</b> Google Slides</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html"><i class="fa fa-check"></i><b>8</b> Feature Selection and Cluster Analysis</a><ul>
<li class="chapter" data-level="8.1" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#abstract"><i class="fa fa-check"></i><b>8.1</b> Abstract</a></li>
<li class="chapter" data-level="8.2" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#seurat-tutorial-redo"><i class="fa fa-check"></i><b>8.2</b> Seurat Tutorial Redo</a><ul>
<li class="chapter" data-level="8.2.1" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#preprocessing-steps"><i class="fa fa-check"></i><b>8.2.1</b> Preprocessing Steps</a></li>
<li class="chapter" data-level="8.2.2" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#start-of-identifying-cell-types"><i class="fa fa-check"></i><b>8.2.2</b> Start of Identifying Cell Types</a></li>
<li class="chapter" data-level="8.2.3" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#run-non-linear-dimensional-reduction-umaptsne"><i class="fa fa-check"></i><b>8.2.3</b> Run non-linear dimensional reduction (UMAP/tSNE)</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#feature-selection"><i class="fa fa-check"></i><b>8.3</b> Feature Selection</a><ul>
<li class="chapter" data-level="8.3.1" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#differential-expression-analysis"><i class="fa fa-check"></i><b>8.3.1</b> Differential Expression Analysis</a></li>
<li class="chapter" data-level="8.3.2" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#check-clusters"><i class="fa fa-check"></i><b>8.3.2</b> Check Clusters</a></li>
<li class="chapter" data-level="8.3.3" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#view-entire-object-structure"><i class="fa fa-check"></i><b>8.3.3</b> View Entire Object Structure</a></li>
<li class="chapter" data-level="8.3.4" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#practice-visualizingembedding"><i class="fa fa-check"></i><b>8.3.4</b> Practice Visualizing/Embedding</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#other-options-for-analysis"><i class="fa fa-check"></i><b>8.4</b> Other Options For Analysis</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html"><i class="fa fa-check"></i><b>9</b> Advanced Topics: Pseudotime Cell Trajectories</a><ul>
<li class="chapter" data-level="9.1" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#google-slides-1"><i class="fa fa-check"></i><b>9.1</b> Google Slides</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="single-cell-resources.html"><a href="single-cell-resources.html"><i class="fa fa-check"></i><b>10</b> Single Cell Resources</a><ul>
<li class="chapter" data-level="10.1" data-path="single-cell-resources.html"><a href="single-cell-resources.html#comprehensive-list-of-single-cell-resources"><i class="fa fa-check"></i><b>10.1</b> Comprehensive list of single-cell resources</a></li>
<li class="chapter" data-level="10.2" data-path="single-cell-resources.html"><a href="single-cell-resources.html#computational-packages-for-single-cell-analysis"><i class="fa fa-check"></i><b>10.2</b> Computational packages for single-cell analysis</a></li>
<li class="chapter" data-level="10.3" data-path="single-cell-resources.html"><a href="single-cell-resources.html#elife-commentary-on-the-human-cell-atlas"><i class="fa fa-check"></i><b>10.3</b> eLife Commentary on the Human Cell Atlas</a></li>
<li class="chapter" data-level="10.4" data-path="single-cell-resources.html"><a href="single-cell-resources.html#online-courses"><i class="fa fa-check"></i><b>10.4</b> Online courses</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ANALYSIS OF SINGLE CELL RNA-SEQ DATA</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="processing-scrnaseq-data" class="section level1">
<h1><span class="header-section-number">4</span> Processing scRNAseq Data</h1>
<div id="goal" class="section level2">
<h2><span class="header-section-number">4.1</span> Goal</h2>
<ul>
<li>To give you experience with examining and aligning fastq files</li>
</ul>
</div>
<div id="further-reading" class="section level2">
<h2><span class="header-section-number">4.2</span> Further reading</h2>
<p>This lab is based on a lab given in:
<a href="http://hemberg-lab.github.io/scRNA.seq.course/processing-raw-scrna-seq-data.html" class="uri">http://hemberg-lab.github.io/scRNA.seq.course/processing-raw-scrna-seq-data.html</a>
For more exercises and ideas please visit their web-site!</p>
</div>
<div id="download-data" class="section level2">
<h2><span class="header-section-number">4.3</span> Download data</h2>
<p>Please downlaod the 6 files from the dropbox folder: <a href="https://www.dropbox.com/sh/98573jes82w0fi7/AAB7Yhwe05MCZTnTZmppxZuta?dl=0" class="uri">https://www.dropbox.com/sh/98573jes82w0fi7/AAB7Yhwe05MCZTnTZmppxZuta?dl=0</a> into the data folder of your copy of github:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="processing-scrnaseq-data.html#cb4-1"></a>cd <span class="dv">2020</span>_scWorkshop<span class="op">/</span>data</span>
<span id="cb4-2"><a href="processing-scrnaseq-data.html#cb4-2"></a>mkdir lab2data</span></code></pre></div>
<p>and copy the files into it
## FastQC</p>
<p>Once you’ve obtained your single-cell RNA-seq data, the first thing you need to do with it is check the quality of the reads you have sequenced. For this task, today we will be using a tool called FastQC. FastQC is a quality control tool for sequencing data, which can be used for both bulk and single-cell RNA-seq data. FastQC takes sequencing data as input and returns a report on read quality. Copy and paste this link into your browser to visit the FastQC website:</p>
<p><a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/" class="uri">https://www.bioinformatics.babraham.ac.uk/projects/fastqc/</a></p>
<p>This website contains links to download and install FastQC and documentation on the reports produced. Fortunately we have already installed FastQC for you today, so instead we will take a look at the documentation. Scroll down the webpage to ‘Example Reports’ and click ‘Good Illumina Data’. This gives an example of what an ideal report should look like for high quality Illumina reads data.</p>
<p>Now let’s make a FastQC report ourselves.</p>
<p>Today we will be performing our analysis using a single cell from an mESC dataset produced by (Kolodziejczyk et al. 2015), which you downloaded froom the github link. The cells were sequenced using the SMART-seq2 library preparation protocol and the reads are paired end.</p>
<p>First, let’s open the docker in a bash mode. open a terminal, cd to the docer folder (the folder you downloaded from github) and run this command:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="processing-scrnaseq-data.html#cb5-1"></a>docker run <span class="op">--</span>rm <span class="op">-</span>ti <span class="op">-</span>v <span class="op">$</span>PWD<span class="op">:</span><span class="er">/</span>home<span class="op">/</span>rstudio <span class="op">-</span>e DISABLE_AUTH=true kdgosik<span class="op">/</span>2020scworkshop bash</span></code></pre></div>
<p>navigate to your data folder:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="processing-scrnaseq-data.html#cb6-1"></a>cd home<span class="op">/</span>rstudio<span class="op">/</span>lab2data</span>
<span id="cb6-2"><a href="processing-scrnaseq-data.html#cb6-2"></a>ls</span></code></pre></div>
<p>You should see the files that you downloaded from the dropbox link.</p>
<p>Now let’s look at the files:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="processing-scrnaseq-data.html#cb7-1"></a>less Teichmann_2i_<span class="dv">2</span>_<span class="dv">2</span>_<span class="fl">1.</span>fastq</span>
<span id="cb7-2"><a href="processing-scrnaseq-data.html#cb7-2"></a>less Teichmann_2i_<span class="dv">2</span>_<span class="dv">2</span>_<span class="fl">2.</span>fastq</span></code></pre></div>
<p>We run fastqc from /usr/local/src/FastQC. You may need to give yourself permissions to run the file (hint: chmod)</p>
<p>Task 1: run fastqc to view the quality of the reads</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="processing-scrnaseq-data.html#cb8-1"></a>chmod <span class="dv">755</span> <span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>src<span class="op">/</span>FastQC<span class="op">/</span>fastqc</span>
<span id="cb8-2"><a href="processing-scrnaseq-data.html#cb8-2"></a><span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>src<span class="op">/</span>FastQC<span class="op">/</span>fastqc <span class="op">-</span>h</span></code></pre></div>
<p>This command will tell you what options are available to pass to FastQC. Let us direct our output to our personal directories (under the folder results). Feel free to ask for help if you get stuck! If you are successful, you should generate a .zip and a .html file for both the forwards and the reverse reads files. Once you have been successful, feel free to have a go at the next section.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="processing-scrnaseq-data.html#cb9-1"></a><span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>src<span class="op">/</span>FastQC<span class="op">/</span>fastqc <span class="op">-</span>o <span class="op">&lt;</span>output_folder<span class="op">&gt;</span><span class="st"> </span>Teichmann_2i_<span class="dv">2</span>_<span class="dv">2</span>_<span class="fl">1.</span>fastq Teichmann_2i_<span class="dv">2</span>_<span class="dv">2</span>_<span class="fl">2.</span>fastq</span></code></pre></div>
<p>Once the command has finished executing, you should have a total of four files - one zip file for each of the paired end reads, and one html file for each of the paired end reads. The report is in the html file.</p>
<p>for those working in AWS, if you want to view the file you will need to download it to your computer. The scp command is:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="processing-scrnaseq-data.html#cb10-1"></a>scp <span class="op">-</span>r <span class="op">-</span>i <span class="op">&lt;</span>your pem file<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>username<span class="op">&gt;</span><span class="er">@</span>ec2<span class="dv">-34-213-180</span><span class="fl">-241.</span>us<span class="op">-</span>west<span class="fl">-2.</span>compute.amazonaws.com<span class="op">:</span><span class="er">~/&lt;</span>file to copy<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>destination <span class="cf">in</span> your computer<span class="op">&gt;</span></span></code></pre></div>
<p>Once the file is on you computer, click on it. Your FastQC report should open. Have a look through the file. Remember to look at both the forwards and the reverse end read reports! How good quality are the reads? Is there anything we should be concerned about?</p>
<div id="fastq-file-format" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Fastq file format</h3>
<p>FastQ is the most raw form of scRNASeq data you will encounter. All scRNASeq protocols are sequenced with paired-end sequencing. Barcode sequences may occur in one or both reads depending on the protocol employed. However, protocols using unique molecular identifiers (UMIs) will generally contain one read with the cell and UMI barcodes plus adapters but without any transcript sequence. Thus reads will be mapped as if they are single-end sequenced despite actually being paired end.</p>
<p>FastQ files have the format:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="processing-scrnaseq-data.html#cb11-1"></a><span class="op">&gt;</span>ReadID</span>
<span id="cb11-2"><a href="processing-scrnaseq-data.html#cb11-2"></a>READ SEQUENCE</span>
<span id="cb11-3"><a href="processing-scrnaseq-data.html#cb11-3"></a><span class="op">+</span></span>
<span id="cb11-4"><a href="processing-scrnaseq-data.html#cb11-4"></a>SEQUENCING QUALITY SCORES</span></code></pre></div>
</div>
</div>
<div id="align-the-reads" class="section level2">
<h2><span class="header-section-number">4.4</span> Align the reads</h2>
<div id="star-align" class="section level3">
<h3><span class="header-section-number">4.4.1</span> STAR align</h3>
<p>Now we have established that our reads are of good quality, we would like to map them to a reference genome. This process is known as alignment. Some form of alignment is generally required if we want to quantify gene expression or find genes which are differentially expressed between samples.</p>
<p>Many tools have been developed for read alignment, but today we will focus on STAR. For each read in our reads data, STAR tries to find the longest possible sequence which matches one or more sequences in the reference genome. Because STAR is able to recognize splicing events in this way, it is described as a ‘splice aware’ aligner.</p>
<p>Usually STAR aligns reads to a reference genome, potentially allowing it to detect novel splicing events or chromosomal rearrangements. However, one issue with STAR is that it needs a lot of RAM, especially if your reference genome is large (eg. mouse and human). To speed up our analysis today, we will use STAR to align reads from to a reference transcriptome of 2000 transcripts. Note that this is NOT normal or recommended practice, we only do it here for reasons of time. We recommend that normally you should align to a reference genome.</p>
<p>Two steps are required to perform STAR alignment. In the first step, the user provides STAR with reference genome sequences (FASTA) and annotations (GTF), which STAR uses to create a genome index. In the second step, STAR maps the user’s reads data to the genome index.</p>
<p>Let’s create the index now. Remember, for reasons of time we are aligning to a transcriptome rather than a genome today, meaning we only need to provide STAR with the sequences of the transcripts we will be aligning reads to. You can obtain transcriptomes for many model organisms from Ensembl (<a href="https://www.ensembl.org/info/data/ftp/index.html" class="uri">https://www.ensembl.org/info/data/ftp/index.html</a>).</p>
<p>Task 2: Create a genome index</p>
<p>First create the output folder for the index in your personal folder under results (recommended /home/rstudio/lab2data/STAR/indices).</p>
<p>We run STAR from:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="processing-scrnaseq-data.html#cb12-1"></a><span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>src<span class="op">/</span>STAR<span class="op">/</span>bin<span class="op">/</span>Linux_x86_<span class="dv">64</span></span></code></pre></div>
<p>using the command:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="processing-scrnaseq-data.html#cb13-1"></a><span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>src<span class="op">/</span>STAR<span class="op">/</span>bin<span class="op">/</span>Linux_x86_<span class="dv">64</span><span class="op">/</span>STAR <span class="op">--</span>runThreadN <span class="dv">4</span> <span class="op">--</span>runMode genomeGenerate <span class="op">--</span>genomeDir <span class="op">&lt;</span>output STAR indices folder<span class="op">&gt;</span><span class="st"> </span><span class="op">--</span>genomeFastaFiles <span class="op">/</span>home<span class="op">/</span>rstudio<span class="op">/</span>lab2data<span class="op">/</span><span class="dv">2000</span>_reference.transcripts.fa</span></code></pre></div>
<p>Now that we have created the index, we can perform the mapping step.</p>
<p>Task 4: Try to work out what command you should use to map our fastq files to the index you created. Use the STAR manual to help you. Once you think you know the answer use ./STAR command to align the fastq files to a BAM file.
You can either create a SAM file and convert it to BAM using samtools, or use STAR to directly output a BAM file (–outSAMtype BAM Unsorted)</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="processing-scrnaseq-data.html#cb14-1"></a><span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>src<span class="op">/</span>STAR<span class="op">/</span>bin<span class="op">/</span>Linux_x86_<span class="dv">64</span><span class="op">/</span>STAR <span class="op">--</span>runThreadN <span class="dv">4</span> <span class="op">--</span>genomeDir <span class="op">&lt;</span>genome_reference<span class="op">&gt;</span><span class="st"> </span><span class="op">--</span>readFilesIn <span class="op">/</span>home<span class="op">/</span>rstudio<span class="op">/</span>lab2data<span class="op">/</span>Teichmann_2i_<span class="dv">2</span>_<span class="dv">2</span>_<span class="fl">1.</span>fastq <span class="op">/</span>home<span class="op">/</span>rstudio<span class="op">/</span>lab2data<span class="op">/</span>Teichmann_2i_<span class="dv">2</span>_<span class="dv">2</span>_<span class="fl">2.</span>fastq <span class="op">--</span>outFileNamePrefix <span class="op">&lt;</span>output_folder<span class="op">&gt;</span><span class="st"> </span><span class="op">--</span>outSAMtype BAM Unsorted</span></code></pre></div>
<p>The alignment may take awhile, if you wish to you can complete tasks 7-10 in the meanwhile.</p>
</div>
<div id="bam-file-format" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Bam file format</h3>
<p>BAM file format stores mapped reads in a standard and efficient manner. The human-readable version is called a SAM file, while the BAM file is the highly compressed version. BAM/SAM files contain a header which typically includes
information on the sample preparation, sequencing and mapping; and a tab-separated row for each individual alignment of each read.</p>
<p>Alignment rows employ a standard format with the following columns:</p>
<p>QNAME : read name (generally will include UMI barcode if applicable)</p>
<p>FLAG : number tag indicating the “type” of alignment, link to explanation of all possible “types”</p>
<p>RNAME : reference sequence name (i.e. chromosome read is mapped to).</p>
<p>POS : leftmost mapping position</p>
<p>MAPQ : Mapping quality</p>
<p>CIGAR : string indicating the matching/mismatching parts of the read (may include soft-clipping).</p>
<p>RNEXT : reference name of the mate/next read</p>
<p>PNEXT : POS for mate/next read</p>
<p>TLEN : Template length (length of reference region the read is mapped to)</p>
<p>SEQ : read sequence</p>
<p>QUAL : read quality</p>
<p>BAM/SAM files can be converted to the other format using ‘samtools’:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="processing-scrnaseq-data.html#cb15-1"></a>samtools view <span class="op">-</span>S <span class="op">-</span>b file.sam <span class="op">&gt;</span><span class="st"> </span>file.bam</span>
<span id="cb15-2"><a href="processing-scrnaseq-data.html#cb15-2"></a>samtools view <span class="op">-</span>h file.bam <span class="op">&gt;</span><span class="st"> </span>file.sam</span></code></pre></div>
<p>Some sequencing facilities will automatically map your reads to the a standard genome and deliver either BAM or CRAM formatted files. Generally they will not have included ERCC sequences in the genome thus no ERCC reads will be mapped in the BAM/CRAM file. To quantify ERCCs (or any other genetic alterations) or if you just want to use a different alignment algorithm than whatever is in the generic pipeline (often outdated), then you will need to convert the BAM/CRAM files back to FastQs:</p>
<p>BAM files can be converted to FastQ using bedtools. To ensure a single copy for multi-mapping reads first sort by read name and remove secondary alignments using samtools. Picard also contains a method for converting BAM to FastQ files.</p>
<p>Bonus:</p>
<p>To make our aligned BAM file easy to navigate (needed for IGViewer) we will sort and index it using samtools.
Sam tools can be run from everywhere (no need to go to a special directory!) using the command:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="processing-scrnaseq-data.html#cb16-1"></a>samtools</span></code></pre></div>
<p>Let us start by sorting the BAM file:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="processing-scrnaseq-data.html#cb17-1"></a>samtools sort Aligned.out.bam <span class="op">-</span>o Aligned.out.sorted.bam</span></code></pre></div>
<p>Task 6: can you index the file? hint: try looking at samtools -h</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="processing-scrnaseq-data.html#cb18-1"></a>samtools index Aligned.out.sorted.bam</span></code></pre></div>
<p>Once you sorted and indexed the files you should have a BAM and a bai files. The BAM file is the aligned reads, and the bai is an index file. To view them in IGViewer (IGV) first copy them into your computer. Go ahead and copy the fa file as well, we will need a reference genome file.</p>
</div>
</div>
<div id="visualization" class="section level2">
<h2><span class="header-section-number">4.5</span> Visualization</h2>
<p>To view the file we will use the IGV you installed on your personal computer.
Open IGV: the default genomes are human HG19 and HG38. Through the class we will be using the PBMC dataset. You have the BAM file in your data folder. Go ahead and transfer it to your computer and upload it to IGV with hg38 as reference genome.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="processing-scrnaseq-data.html#cb19-1"></a>Task <span class="dv">7</span><span class="op">:</span><span class="st"> </span>Browse to MS4A1, this is a blood cell marker. Can you see the exons and the introns? Where are most of the aligned reads?</span>
<span id="cb19-2"><a href="processing-scrnaseq-data.html#cb19-2"></a></span>
<span id="cb19-3"><a href="processing-scrnaseq-data.html#cb19-3"></a>Task <span class="dv">8</span><span class="op">:</span><span class="st"> </span>Search <span class="cf">in</span> IGV or online <span class="op">-</span><span class="st"> </span>can you present splice junctions? (right click -&gt;<span class="st"> </span>“Show splice junction track”)</span>
<span id="cb19-4"><a href="processing-scrnaseq-data.html#cb19-4"></a></span>
<span id="cb19-5"><a href="processing-scrnaseq-data.html#cb19-5"></a>Task <span class="dv">9</span><span class="op">:</span><span class="st"> </span>Try further tasks that interest you <span class="cf">in</span> IGV. For example, can you detect reads that are within one exon and reads that start <span class="cf">in</span> one exon and continue <span class="cf">in</span> the <span class="cf">next</span>? Can you copy the sequence of exon2 <span class="cf">in</span> MS4A1?</span>
<span id="cb19-6"><a href="processing-scrnaseq-data.html#cb19-6"></a></span>
<span id="cb19-7"><a href="processing-scrnaseq-data.html#cb19-7"></a>Task <span class="dv">10</span><span class="op">:</span><span class="st"> </span>What would have happened <span class="cf">if</span> you chose the wrong reference genome, such as hg19?</span></code></pre></div>
<p>Bonus 2 (IGV sometimes has difficulties loading small fa files. So if this becomes difficult - don’t worry! It’s not your alignment):</p>
<p>The default genomes are human HG19 and HG38. However you can also upload your reference genome of choice. As we created our own fasta file we can now upload it as a reference genome.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="processing-scrnaseq-data.html#cb20-1"></a>Task <span class="dv">11</span><span class="op">:</span><span class="st"> </span>Load new genome<span class="op">:</span><span class="st"> </span>go to “Genomes”-&gt;”Load from file” and load the file <span class="dv">2000</span>_reference.transcripts.fa</span>
<span id="cb20-2"><a href="processing-scrnaseq-data.html#cb20-2"></a></span>
<span id="cb20-3"><a href="processing-scrnaseq-data.html#cb20-3"></a>Task <span class="dv">12</span><span class="op">:</span><span class="st"> </span>Now load your reads<span class="op">:</span><span class="st"> </span>go to “File”-&gt;”Load from file” and load your BAM file. Notice that IGV needs a BAM and a bai saved <span class="cf">in</span> the same location. IGV uses the bai to navigate through the BAM file. </span>
<span id="cb20-4"><a href="processing-scrnaseq-data.html#cb20-4"></a></span>
<span id="cb20-5"><a href="processing-scrnaseq-data.html#cb20-5"></a>Task <span class="dv">13</span><span class="op">:</span><span class="st"> </span>Some of the reads have a nucleotide substitution <span class="cf">in</span> position <span class="dv">993</span> <span class="op">-</span><span class="st"> </span>what is the reference nucleotide? What is the substitution?</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lecture-template.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="understanding-sequencing-raw-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["2020_scWorkshop.pdf", "2020_scWorkshop.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
